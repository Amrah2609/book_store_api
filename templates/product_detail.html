{% extends "include/base.html" %}
{% load static %}
{% block body %}

<div class="container mt-4">
    <div class="row">
        <div class="col-md-6">
            <div id="productCarousel" class="carousel slide" data-ride="carousel">
                <div class="carousel-inner" id="carousel-inner">
                    <!-- Şəkillər JS ilə əlavə olunacaq -->
                </div>
                <a class="carousel-control-prev" href="#productCarousel" role="button" data-slide="prev">
                    <span class="carousel-control-prev-icon"></span>
                </a>
                <a class="carousel-control-next" href="#productCarousel" role="button" data-slide="next">
                    <span class="carousel-control-next-icon"></span>
                </a>
            </div>
        </div>
        <div class="col-md-6">
            <h2 id="title"></h2>
            <p><strong>Author:</strong> <span id="author"></span></p>
            <p><strong>Categories:</strong> <span id="categories"></span></p>
            <p><strong>Price:</strong> <span id="price"></span></p>
            <p id="description"></p>
        </div>
    </div>

    <hr>

    <h3>Customer Reviews</h3>
    <div id="reviews"></div>
</div>

<script>
const productId = "{{ product_id }}";

// PRODUCT DETAILS
fetch(`/api/products/${productId}`)
.then(res => res.json())
.then(product => {
    document.getElementById("title").innerText = product.title;
    document.getElementById("author").innerText = product.author.name;
    document.getElementById("price").innerText = product.price + " " + product.currency;
    document.getElementById("description").innerText = product.description;
    document.getElementById("categories").innerText = product.categories.map(c => c.name).join(", ");

    // Şəkilləri carousel-ə əlavə et
    const carouselInner = document.getElementById("carousel-inner");
    carouselInner.innerHTML = ""; 
    product.images.forEach((img, index) => {
        const active = index === 0 ? "active" : "";
        carouselInner.innerHTML += `
            <div class="carousel-item ${active}">
                <img src="${img}" class="d-block w-100">
            </div>
        `;
    });
})
.catch(err => console.error(err));

// REVIEWS
fetch(`/api/products/${productId}/reviews`)
.then(res => res.json())
.then(reviews => {
    const container = document.getElementById("reviews");
    container.innerHTML = "";
    if (reviews.length === 0) {
        container.innerHTML = "<p>No reviews yet.</p>";
        return;
    }
    reviews.forEach(r => {
        container.innerHTML += `
            <div class="review">
                <p><strong>${r.user}</strong> - ${r.stars} stars</p>
                <p>${r.review}</p>
            </div>
        `;
    });
})
.catch(err => console.error(err));
</script>

{% endblock %}
